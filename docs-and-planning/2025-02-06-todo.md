# February 6, 2025 — To-Do List

## Issue: Voice assistant is too eager to talk

The voice assistant jumps in too quickly or talks too much unprompted. It feels overly eager rather than patient and conversational.

### Root causes to investigate

There are several areas in the codebase that could contribute to this behavior. Work through them in order.

---

### 1. Tune OpenAI Realtime turn detection settings

**File:** `app/src/components/voice-chat.tsx` (line ~270)

The `RealtimeSession` is created with no turn detection configuration:

```js
const newSession = new RealtimeSession(agent, {
  model: "gpt-4o-mini-realtime-preview",
});
```

The OpenAI Realtime API supports `turn_detection` settings that control how the model decides the user is done speaking. Without explicit config, the defaults may be too aggressive (jumping in after short pauses).

**Try:**
- Add `turn_detection` config with a longer `silence_duration_ms` (e.g. 800–1200ms instead of the default ~500ms)
- Increase `threshold` (VAD sensitivity) so it doesn't interpret background noise as speech
- Increase `prefix_padding_ms` to give the user more buffer time

```js
const newSession = new RealtimeSession(agent, {
  model: "gpt-4o-mini-realtime-preview",
  sessionConfig: {
    turn_detection: {
      type: "server_vad",
      threshold: 0.6,              // default ~0.5, higher = less sensitive
      silence_duration_ms: 1000,    // default ~500, wait longer before responding
      prefix_padding_ms: 500,       // default ~300, more buffer before speech start
    },
  },
});
```

**How to verify:** Call in, pause mid-sentence, and see if the bot waits longer before responding.

---

### 2. Tone down the system prompt

**File:** `app/src/components/voice-chat.tsx` (lines 23–62)

The current instructions tell the agent to:
- Give a greeting immediately on connect (lines 26–29)
- "Always offer to help with anything else after completing an action" (line 46)

These make the assistant proactively fill silence. Consider:

- [ ] Shorten the greeting — make it 1 sentence max ("Hi, I'm AdherePod. How can I help?")
- [ ] Remove "Always offer to help with anything else after completing an action" — let the user drive the conversation
- [ ] Add explicit instruction: "Wait for the user to finish speaking before responding. Do not fill silence. Be patient."
- [ ] Add: "Keep responses short — 1-2 sentences unless the user asks for detail."

---

### 3. Check if camera messages trigger unwanted responses

**File:** `app/src/components/voice-chat.tsx` (lines 208–211)

Every 5 seconds, a camera description is injected via `sendMessage`:

```js
currentSession.sendMessage(`[Camera: ${description}]`);
```

This may be prompting the agent to respond out loud to routine camera frames, even though the system prompt says not to. If the agent is reacting to "[Camera: Person sitting at desk]" type messages, that would feel very eager.

**Try:**
- [ ] Test with camera disabled — does the eagerness go away?
- [ ] If yes, increase `AUTO_CAPTURE_INTERVAL_MS` from 5000 to 10000–15000ms
- [ ] Add stronger system prompt language: "NEVER speak in response to routine camera updates. Only respond to camera if medication/prescription content is detected."
- [ ] Consider only sending camera messages when `hasMedicalContent` is true

---

### 4. Check the ephemeral session config on the server

**File:** `app/src/app/api/voice/session/route.ts`

The server-side session creation sends minimal config:

```js
body: JSON.stringify({
  session: {
    type: "realtime",
    model: "gpt-4o-mini-realtime-preview",
  },
}),
```

This could also accept turn detection and other behavior settings. If client-side config doesn't work, try setting it here instead.

---

### Testing plan

1. Start with fix #1 (turn detection) — this is the most likely cause and easiest to test
2. If still eager, apply fix #2 (system prompt changes)
3. If still eager with camera on but fine without, apply fix #3
4. Test each change by having a real conversation — pause mid-thought, stay silent for a few seconds, and see if the bot waits appropriately

### Success criteria

- The bot waits at least 1 second of silence before responding
- The bot does not talk unprompted (except the initial greeting)
- The bot does not react out loud to routine camera frames
- Responses are concise (1-2 sentences) unless the user asks for more detail
