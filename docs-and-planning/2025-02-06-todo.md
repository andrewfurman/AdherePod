# February 6, 2025 — To-Do List

## Issue: Voice assistant is too eager / talks over the user

The voice assistant jumps in too often, largely because camera descriptions are sent to the model every 5 seconds via `sendMessage`, which triggers a model response each time. On top of that, the system prompt tone is a bit formal — we want it more casual and laid-back.

---

### 1. Fix camera messages triggering unwanted responses (PRIMARY FIX)

**File:** `app/src/components/voice-chat.tsx` (lines 208–211)

**The problem:** Every 5 seconds, `processCapture` sends a camera frame to our API, gets a text description back, then injects it into the agent via:

```js
currentSession.sendMessage(`[Camera: ${description}]`);
```

`sendMessage` tells the model "here's new user input" — the model treats it like the user said something and generates a spoken response. Even if the system prompt says "don't react to routine frames," the model still gets prompted to respond every 5 seconds. This is the main reason it feels eager.

**Proposed fix — only send camera context when it matters:**

- [ ] **Option A: Only `sendMessage` when `hasMedicalContent` is true.** For routine frames (person sitting, blank wall, etc.), store the description in a ref but do NOT call `sendMessage`. The bot only gets camera input when there's something medical to react to (pill bottle, prescription, etc.).

```js
// Store latest description for context (bot can reference if user asks)
lastDescriptionRef.current = description;

// Only inject into agent when there's something worth reacting to
if (hasMedicalContent && currentSession) {
  currentSession.sendMessage(`[Camera: ${description}]`);
}
```

- [ ] **Option B: Use `addImage` with `triggerResponse: false` instead of `sendMessage`.** The SDK has an `addImage(image, { triggerResponse: false })` method that adds context without prompting a response. We could send the raw image this way. However, this may use more tokens since it sends the image itself rather than a text summary.

- [ ] **Option C: Buffer descriptions and inject on user turn.** Store all camera descriptions in a buffer. When we detect a user speech event (`conversation.item.input_audio_transcription.completed`), prepend the latest camera context to the user's turn. This way the bot only sees camera info when it's already responding to the user.

**Recommendation:** Start with Option A — it's the simplest and most targeted fix. The bot still reacts to prescriptions/bottles held up to the camera, but stops talking over you about routine frames.

**Also consider:**
- [ ] Increase `AUTO_CAPTURE_INTERVAL_MS` from 5000 to 10000–15000ms as an additional measure
- [ ] Test with camera fully disabled first to confirm this is the root cause

---

### 2. Make the system prompt more casual

**File:** `app/src/components/voice-chat.tsx` (lines 23–62)

The current prompt is helpful but reads a bit stiff and clinical. We want the bot to feel like a chill, friendly helper — not a nurse reading from a script.

**Changes to make:**

- [ ] Rewrite the greeting to be shorter and more casual:
  - Current: "Hi there! I'm AdherePod, your medication assistant. I can help you review your medications, update your list if your doctor made any changes, or answer questions about how your medications work together. You can also hold up a prescription or pill bottle to the camera and I'll read it for you. What can I help you with today?"
  - New: "Hey! I'm AdherePod. I help keep track of your meds. What's up?"

- [ ] Change the overall tone instruction — add something like:
  - "Be casual and conversational, like a friendly neighbor who happens to know about medications. Don't be overly formal or clinical. Use simple, everyday language."
  - "Keep your responses short and natural — a sentence or two is usually enough. Don't lecture."

- [ ] Remove "Always offer to help with anything else after completing an action" — this makes the bot fill silence. Let the user drive.

- [ ] Add patience instruction:
  - "Don't rush. If the user pauses, give them time — they might be thinking. Wait for them to finish before jumping in."

- [ ] Tone down the camera instructions to be less robotic — instead of "proactively mention it and offer to add it to their medication list," say something like "casually mention what you noticed and ask if they want to add it."

---

### 3. Eagerness / turn detection settings (OPTIONAL — try if needed)

**File:** `app/src/components/voice-chat.tsx` (line ~270)

The OpenAI Realtime API supports an `eagerness` parameter via `semantic_vad` turn detection. The SDK accepts this through the `config` option on `RealtimeSession`:

```js
const newSession = new RealtimeSession(agent, {
  model: "gpt-4o-mini-realtime-preview",
  config: {
    audio: {
      input: {
        turnDetection: {
          type: "semantic_vad",
          eagerness: "low",          // "low" | "medium" | "high" | "auto"
          interruptResponse: true,
        },
      },
    },
  },
});
```

`eagerness: "low"` tells the model to let users take their time and not jump in at every pause.

**Note:** This should be a secondary fix. The camera `sendMessage` issue (#1) is almost certainly the main problem. If the bot still feels too eager after fixing that, then dial eagerness down to `"low"`.

There's also the classic `server_vad` with manual thresholds if `semantic_vad` isn't enough:

```js
turnDetection: {
  type: "server_vad",
  threshold: 0.6,            // default ~0.5, higher = less sensitive to noise
  silenceDurationMs: 1000,   // default ~500, wait longer before responding
  prefixPaddingMs: 500,      // default ~300, more buffer
}
```

---

### Testing plan

1. **Confirm the root cause:** Disable camera entirely (comment out `startCamera()` in `connect`) and test — does the eagerness go away?
2. **Apply fix #1 (Option A):** Only `sendMessage` camera descriptions when `hasMedicalContent` is true. Test with camera on.
3. **Apply fix #2:** Update the system prompt to be more casual. Test the greeting and general conversational feel.
4. **If still too eager:** Apply fix #3 — set `eagerness: "low"` on `semantic_vad`.
5. **End-to-end test:** Have a real conversation — pause mid-sentence, stay silent, hold up a pill bottle, and verify the bot only speaks when appropriate.

### Success criteria

- The bot does NOT talk over the user or respond to routine camera frames
- The bot DOES react when a prescription or pill bottle is held up to the camera
- The greeting is short and casual
- Responses feel conversational, not clinical
- The bot waits patiently during pauses
